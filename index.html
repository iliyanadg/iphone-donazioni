<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aiutami a sistemare l‚ÄôiPhone üì±</title>
  <meta name="description" content="Donazioni via PayPal o Revolut. Feed donatori automatico da Google Sheet (CSV) e promo: 2 mesi gratis per donazioni ‚â• 10‚Ç¨." />
  <style>
    :root{--bg:#0b0b10;--card:#12121a;--soft:#1c1c28;--txt:#f5f7fb;--muted:#b9bed1;--acc:#ff4fd8;--acc2:#7abfff;--ok:#31d0aa}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(1200px 700px at 80% -10%,#1b1230 0%,#0b0b10 60%),var(--bg);color:var(--txt)}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:28px}
    header{display:flex;flex-wrap:wrap;gap:16px;align-items:center;justify-content:space-between;margin:12px 0 24px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg,var(--acc),#ffa6ed);display:grid;place-items:center;color:#170b1a;font-weight:900;box-shadow:0 10px 20px rgba(255,79,216,.25)}
    h1{font-size:clamp(20px,3vw,30px);margin:0}
    .sub{color:var(--muted);font-size:14px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.00));border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:20px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1.2fr .8fr}}
    .goal{display:flex;align-items:end;justify-content:space-between;margin:2px 0 12px}
    .goal strong{font-size:28px}
    .muted{color:var(--muted)}
    .bar{height:16px;border-radius:999px;background:var(--soft);position:relative;overflow:hidden}
    .fill{position:absolute;inset:0 100% 0 0;background:linear-gradient(90deg,var(--acc) 0%, var(--acc2) 100%);box-shadow:0 4px 20px rgba(122,191,255,.35)}
    .stats{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
    .pill{background:var(--soft);border:1px solid rgba(255,255,255,.08);padding:10px 12px;border-radius:999px;font-size:14px}
    .btns{display:grid;grid-template-columns:1fr;gap:10px;margin-top:14px}
    .btn{display:flex;align-items:center;justify-content:center;gap:10px;padding:14px;border-radius:14px;border:1px solid rgba(255,255,255,.1);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.00));font-weight:700;cursor:pointer}
    .btn:hover{transform:translateY(-1px);transition:transform .15s ease}
    .feed{max-height:420px;overflow:auto;padding-right:8px}
    .donor{display:flex;align-items:center;gap:12px;padding:10px;border-radius:12px;margin:6px 0;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06)}
    .amt{margin-left:auto;font-weight:800;color:var(--ok)}
    .time{font-size:12px;color:var(--muted)}
    .ticker{overflow:hidden;white-space:nowrap;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:linear-gradient(90deg,rgba(255,255,255,.02),rgba(255,255,255,.00));padding:10px;margin:10px 0}
    .marquee{display:inline-block;animation:scroll 22s linear infinite}
    @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
    footer{margin:26px 0;color:var(--muted);font-size:13px;text-align:center}
    .contact{display:flex;align-items:center;gap:10px;margin-top:14px;padding:12px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:rgba(255,255,255,.02)}
    .contact a{font-weight:800;text-decoration:underline}
    .promo{margin-top:12px;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:linear-gradient(180deg,rgba(122,191,255,.12),rgba(255,255,255,0));font-weight:700}
    .promo small{display:block;color:var(--muted);font-weight:500;margin-top:4px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">üíñ</div>
        <div>
          <h1>Aiutami a sistemare l‚ÄôiPhone</h1>
          <div class="sub">Piccole donazioni = grande differenza. Trasparenza totale qui sotto ‚ú®</div>
        </div>
      </div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="goal"><strong id="raisedLabel">‚Ç¨0</strong><span class="muted" id="targetLabel">obiettivo ‚Ç¨600</span></div>
        <div class="bar"><div class="fill" id="fill" style="width:0%"></div></div>
        <div class="stats">
          <div class="pill">Donatori: <b id="count">0</b></div>
          <div class="pill">Mancano: <b id="left">‚Ç¨0</b></div>
          <div class="pill">Ultima donazione: <b id="last">‚Äî</b></div>
        </div>

        <div class="btns">
          <a class="btn" id="paypalBtn" href="https://paypal.me/iliyanadg" target="_blank" rel="noopener noreferrer">üí∏ Dona con PayPal</a>
          <a class="btn" id="revolutBtn" href="https://revolut.me/iliyan3gd8" target="_blank" rel="noopener noreferrer">‚ö°Ô∏è Paga con Revolut</a>
          <!-- NOTA: questo √® un link di MODIFICA del Form. Appena puoi, sostituiscilo con "Invia ‚Üí link" (pubblico). -->
          <a class="btn" id="formBtn" href="https://docs.google.com/forms/d/e/1FAIpQLSflaXPMs1gmBiewNUqfiSqwRyUy3OOWNRIKeTjuAof8Wtx6Yw/viewform?usp=dialog" target="_blank" rel="noopener noreferrer">üìù Dopo la donazione: lascia il tuo nome</a>
        </div>

        <div class="promo">
          ü§çüíô <b>PROMO LANCIO:</b> chi dona <b>‚â• 10‚Ç¨</b> ricever√† <b>2 mesi gratuiti</b> quando lancio.
          <small>Per riscattare: lascia IG nel form oppure scrivimi su <a href="https://instagram.com/iliyanadg" target="_blank" rel="noopener noreferrer">@iliyanadg</a>.</small>
        </div>

        <div class="contact">
          üì© <span class="muted">Contatto diretto:</span> Instagram
          <a href="https://instagram.com/iliyanadg" target="_blank" rel="noopener noreferrer">@iliyanadg</a>
        </div>

        <div class="ticker"><span class="marquee" id="ticker">Grazie a tutt* per il supporto üíñ</span></div>

        <h3 style="margin:12px 0 6px">Ultimi sostenitori</h3>
        <div class="feed" id="feed"></div>
      </section>

      <aside class="card">
        <h3 style="margin:6px 0 8px">Come funziona</h3>
        <p class="muted">Scegli PayPal o Revolut. Dopo la donazione, compila il form: il tuo nome apparir√† nel feed. üíï</p>
        <ul class="muted">
          <li>PayPal: <code>paypal.me/iliyanadg</code></li>
          <li>Revolut: <code>revolut.me/iliyan3gd8</code></li>
        </ul>
        <p class="muted">Se vuoi restare anonimo, scrivi ‚Äúanonimo‚Äù nel form.</p>
        <div class="pill" style="display:inline-block;margin-top:8px">IG: <b>@iliyanadg</b></div>
      </aside>
    </div>

    <footer>¬© Iliyana ‚Äî grazie per ogni aiuto! üå∏</footer>
  </div>

  <script>
    // ====== CONFIG ======
    const CONFIG = {
      target: 600,
      paypal: 'https://paypal.me/iliyanadg',
      revolut: 'https://revolut.me/iliyan3gd8',
      supporters: [
        { name: 'Anonimo', amount: 20, note: 'Forza! üí™', time: '2025-09-20T21:10:00Z' }
      ]
    };

    // CSV pubblico (pubblica sul web ‚Üí Link ‚Üí "Risposte del modulo 1" ‚Üí CSV)
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT3S4ETrSZv34R7AqhHaRzQDbfHOLq5ZRiA5hg-EriSQs1uEIHVDw_zdMjkfdS3wSnvbrN0r009VNrf/pub?gid=470744628&single=true&output=csv';

    // === mappa colonne del tuo foglio: A Timestamp | B Nome | C Importo
    const COLS = { name: 1, amount: 2, timestamp: 0 };

    // ====== UTIL ======
    function ‚Ç¨(n){ return new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR'}).format(n); }
    const byTime = (a,b)=> new Date(b.time)-new Date(a.time);

    function sanitizeAmount(v){
      if (v == null) return 0;
      v = String(v).replace(/[‚Ç¨\s]/g,'');          // togli ‚Ç¨ e spazi
      if (v.includes(',') && !v.includes('.')) v = v.replace(',', '.'); // 10,50 -> 10.50
      const n = Number(v);
      return Number.isFinite(n) && n > 0 ? Math.round(n*100)/100 : 0;
    }

    function parseCSV(text){
      const lines = text.trim().split(/\r?\n/);
      if (lines.length <= 1) return [];
      const rows = lines.slice(1).map(l =>
        l.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c => c.replace(/^"|"$/g,''))
      );

      return rows.map(r => ({
        name: r[COLS.name] || 'Anonimo',
        amount: sanitizeAmount(r[COLS.amount]),
        note: '', // non hai la colonna messaggio
        time: r[COLS.timestamp] ? new Date(r[COLS.timestamp]).toISOString() : new Date().toISOString()
      })).filter(x => x.amount > 0);
    }

    async function loadDonors(){
      try{
        const res = await fetch(CSV_URL, { cache:'no-store' });
        if(!res.ok) throw new Error('CSV non accessibile');
        const txt = await res.text();
        const fromSheet = parseCSV(txt);
        return fromSheet.length ? fromSheet : CONFIG.supporters;
      }catch(e){
        console.warn('Uso fallback locale:', e);
        return CONFIG.supporters;
      }
    }

    (async function init(){
      document.getElementById('paypalBtn').href = CONFIG.paypal;
      document.getElementById('revolutBtn').href = CONFIG.revolut;

      const supporters = (await loadDonors()).sort(byTime);
      const sum = supporters.reduce((t,s)=> t + Number(s.amount||0), 0);
      const pct = Math.min(100, Math.round((sum/CONFIG.target)*100));

      document.getElementById('raisedLabel').textContent = ‚Ç¨(sum);
      document.getElementById('targetLabel').textContent = 'obiettivo ' + ‚Ç¨(CONFIG.target);
      document.getElementById('fill').style.width = pct + '%';
      document.getElementById('count').textContent = supporters.length;
      document.getElementById('left').textContent = ‚Ç¨(Math.max(0, CONFIG.target - sum));

      const last = supporters[0];
      document.getElementById('last').textContent = last ? new Date(last.time).toLocaleString('it-IT') : '‚Äî';

      const feedEl = document.getElementById('feed');
      feedEl.innerHTML = '';
      supporters.forEach(s=>{
        const row = document.createElement('div');
        row.className = 'donor';
        row.innerHTML = `<div>üë§ <b>${s.name||'Anonimo'}</b>
                           <div class="time">${new Date(s.time).toLocaleString('it-IT')}</div>
                         </div>
                         <div class="muted">${''}</div>
                         <div class="amt">+ ${‚Ç¨(s.amount||0)}</div>`;
        feedEl.appendChild(row);
      });

      const ticker = document.getElementById('ticker');
      const phrases = supporters.map(s=> `${s.name||'Anonimo'} +${‚Ç¨(s.amount||0)}`);
      ticker.textContent = (phrases.join(' ‚Ä¢ ') + ' ‚Ä¢ ').repeat(2);
    })();
  </script>
</body>
</html>



